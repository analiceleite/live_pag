<div class="rounded-2xl bg-white shadow-sm hover:shadow-md border border-gray-100 transition-all duration-300">
    <!-- Client Header -->
    <div class="p-5 border-b border-gray-100">
        <div class="flex justify-between items-start">
            <div class="space-y-1">
                <div class="flex items-center flex-wrap gap-2">
                    <h3 class="text-xl font-semibold text-gray-900">{{ client.client }}</h3>

                    <!-- Badges -->
                    <div class="flex flex-wrap gap-1">
                        <span *ngIf="hasDeliveryRequested(client) && !hasDeliverySent(client)"
                            class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                            <svg class="mr-1 h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4">
                                </path>
                            </svg>
                            Entrega Solicitada
                        </span>
                        <span *ngIf="hasDeliverySent(client)"
                            class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            <svg class="mr-1 h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4">
                                </path>
                            </svg>
                            Entrega Realizada
                        </span>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <p class="text-sm text-gray-500">CPF: {{ client.cpf }}</p>
                    <p class="text-sm font-medium text-gray-700">
                        <span class="text-green-600 font-semibold">R$ {{ getTotalAmount(client) | number:
                            '1.2-2' }}</span>
                    </p>
                </div>
            </div>
            <div class="flex gap-2">
                <button
                    class="text-sm font-medium text-indigo-600 bg-indigo-50 hover:bg-indigo-100 px-3 py-1.5 rounded-lg transition duration-200 flex items-center gap-1"
                    (click)="onToggleClient(client.cpf)">
                    <span>{{ selectedClientCpf === client.cpf ? 'Fechar' : 'Ver Compras' }}</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" [ngClass]="{
                            'rotate-180': selectedClientCpf === client.cpf
                        }">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <button *ngIf="selectedTab === 'open'"
                    class="text-sm font-medium text-green-600 bg-green-50 hover:bg-green-100 px-3 py-1.5 rounded-lg transition duration-200 flex items-center gap-1"
                    (click)="onSendWhatsApp()">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 01-.923 1.785A5.969 5.969 0 006 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337z">
                        </path>
                    </svg>
                    <span>WhatsApp</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Purchases List -->
    <div *ngIf="selectedClientCpf === client.cpf" class="p-4 bg-gray-50 rounded-b-2xl">
        <div class="space-y-4">
            <!-- Purchase Group -->
            <app-purchase-group 
                *ngFor="let group of client.purchase_groups"
                [group]="group"
                [client]="client"
                [pixKeys]="pixKeys" 
                (pixKeySelected)="onGroupPixKeySelected($event)"
                [selectedTab]="selectedTab"
                (toggleGroup)="onToggleGroup($event)"
                (markAsPaid)="onMarkGroupAsPaid($event)"
                (markAsSent)="onMarkGroupAsSent($event)"
                (markAsDeleted)="onMarkGroupAsDeleted($event)"
                (returnToOpen)="onReturnGroupToOpen($event)"
                (openTrackingDialog)="onOpenTrackingDialog($event)">
            </app-purchase-group>
        </div>
    </div>
</div>
